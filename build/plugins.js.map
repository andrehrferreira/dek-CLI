{"version":3,"sources":["../src/plugins.js"],"names":["prompt","inquirer","createPromptModule","CLIPath","path","resolve","dirname","fs","realpathSync","__filename","PackageJSON","require","join","i18n","configure","locales","defaultLocale","directory","Plugins","plugins","pathName","forEach","pluginName","installPlugin","Promise","reject","pluginPathResolve","process","cwd","statSync","isDirectory","mkdirSync","recursive","console","log","chalk","green","child","shell","env","on","err","exitCode","setTimeout","then","paths","dependenciesArr","pluginPackagePath","pluginPackageRequest","_","merge","Object","keys","dependencies","type","name","default","__","message","validate","value","length","newPluginSettings","red","installPlugins","argv","h","Help"],"mappings":"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","file":"plugins.js","sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\n\nimport 'babel-polyfill';\nimport chalk from \"chalk\";\nimport globby from \"globby\";\nimport _ from \"lodash\";\nimport inquirer from \"inquirer\";\nimport i18n from \"i18n\";\nimport { spawn } from \"child_process\";\n\nlet prompt = inquirer.createPromptModule();\n\nconst CLIPath = path.resolve(path.dirname(fs.realpathSync(__filename)), \"../\");\nconst PackageJSON = require(path.join(CLIPath, \"package\"));\n\ni18n.configure({\n    locales: ['en'],\n    defaultLocale: 'en',\n    directory: path.join(CLIPath, \"locales\")\n});\n\nclass Plugins{\n    async installPlugins(plugins, pathName){\n        await plugins.forEach(async (pluginName) => {\n            await this.installPlugin(pluginName, pathName);\n        });\n    }\n\n    async installPlugin(pluginName, pathName){\n        return new Promise((resolve, reject) => {\n            if(pathName)\n                var pluginPathResolve = path.resolve(pathName);\n            else\n                var pluginPathResolve = path.resolve(path.join(process.cwd(), \"src\", \"plugins\"));\n\n            (async () => {\n                try {\n                    if(!fs.statSync(pluginPathResolve).isDirectory())\n                        await fs.mkdirSync(pluginPathResolve, { recursive: true });\n                }\n                catch (err) {\n                    fs.mkdirSync(pluginPathResolve, { recursive: true });\n                }\n            })();\n\n            console.log(chalk.green(`[${pluginName}] Installing ...`));\n\n            var child = spawn(`git clone https://github.com/dekproject/${pluginName}`, {\n                shell: true,\n                env: process.env,\n                cwd: pluginPathResolve\n            });\n\n            child.on('error', function (err) {\n                reject(`[${pluginName}] ${err}`);\n            });\n\n            child.on('exit', function (exitCode) {\n                resolve();\n            });\n        });\n    }\n\n    loadPackageDependencies(pathName){\n        return new Promise((resolve, reject) => {\n            if(pathName)\n                var pluginPathResolve = path.resolve(pathName);\n            else\n                var pluginPathResolve = path.resolve(path.join(process.cwd(), \"src\", \"plugins\"));\n\n            setTimeout(() => {\n                globby([`${pluginPathResolve}/*/package.json`]).then((paths) => {\n                    var dependenciesArr = [];\n\n                    paths.forEach((pluginPackagePath) => {\n                        var pluginPackageRequest = require(pluginPackagePath);\n                        dependenciesArr = _.merge(dependenciesArr, Object.keys(pluginPackageRequest.dependencies));\n                    });\n\n                    resolve(dependenciesArr.join(\" \"));\n                });\n            }, 3000);\n        });\n    }\n\n    new(){\n        var pluginPathResolve = path.resolve(path.join(process.cwd(), \"src\", \"plugins\"));\n\n        (async () => {\n            try {\n                if(!fs.statSync(pluginPathResolve).isDirectory())\n                    await fs.mkdirSync(pluginPathResolve, { recursive: true });\n            }\n            catch (err) {\n                fs.mkdirSync(pluginPathResolve, { recursive: true });\n            }\n        })();\n\n        prompt([{\n            type: \"input\",\n            name: \"name\",\n            default: i18n.__(\"myplugin\"),\n            message: i18n.__(\"What is the name of the plugin?\"),\n            validate: (value) => {\n                if (value.length)\n                    return true;\n                else\n                    return i18n.__(\"Please set a valid value\");\n            }\n        }]).then(async newPluginSettings => {\n            var child = spawn(`git clone https://github.com/dekproject/plugin-bootstrap ${newPluginSettings.name}`, {\n                shell: true,\n                cwd: pluginPathResolve\n            });\n\n            child.on('error', function (err) {\n                console.log(chalk.red(`[${newPluginSettings.name}] ${err}`));\n            });\n\n            child.on('exit', function (exitCode) {\n                console.log(chalk.green(`[${newPluginSettings.name}] creating successfully!`));\n            });\n        });\n    }\n}\n\nexport let plugins = new Plugins();\nexport let installPlugins = new Plugins().installPlugins;\nexport let installPlugin = new Plugins().installPlugin;\n\nexport default async (argv) => {\n    let plugins = new Plugins();\n\n    if(argv.h){\n        plugins.Help();\n    }\n};\n"]}