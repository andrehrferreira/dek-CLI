{"version":3,"sources":["../src/install.js"],"names":["CLIPath","path","resolve","dirname","fs","realpathSync","__filename","PackageJSON","require","join","prompt","inquirer","createPromptModule","registerPrompt","Install","self","packageJSONTemplate","settings","devmode","installDevMode","installedDevMode","frontend","installFrontendFramework","installedWebpack","installWebpack","installedFrontend","installInterval","setInterval","clearInterval","console","log","chalk","green","i18n","__","writeFile","JSON","stringify","err","type","name","message","then","result","install","child","shell","env","process","cwd","stdio","stdin","stdout","stderr","on","exitCode","usageText","cliDevMode","exit","__self","directoryExists","addPackageDependencies","devMode","e","red","webpack","webpackLoaders","WebpackConfigTemplate","writeFileSync","scripts","callback","totalScripts","loadedScripts","forEach","parScript","test","replace","split","dependency","devDependencies","dependencies","filePath","statSync","isDirectory","argv","h","Help","_","length"],"mappings":"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","file":"install.js","sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport npm from \"npm\";\n\nimport 'babel-polyfill';\nimport minimist from \"minimist\";\nimport chalk from \"chalk\";\nimport inquirer from \"inquirer\";\nimport i18n from \"i18n\";\nimport _ from \"lodash\";\nimport gitClone from \"git-clone\";\nimport rimraf from \"rimraf\";\nimport { exec, spawn } from \"child_process\";\n\nimport { installPlugins } from \"./plugins\";\n\nconst CLIPath = path.resolve(path.dirname(fs.realpathSync(__filename)), \"../\");\nconst PackageJSON = require(path.join(CLIPath, \"package\"));\n\nlet prompt = inquirer.createPromptModule();\ninquirer.registerPrompt('fuzzypath', require('inquirer-fuzzy-path'));\n\nexport class Install{\n    async bootstrap(self, packageJSONTemplate){\n        this.packageJSONTemplate = packageJSONTemplate;\n\n        if(self.settings.devmode)\n            await this.installDevMode(self);\n        else\n            this.installedDevMode = true;\n\n        if(self.settings.frontend != \"none\"){\n            await this.installFrontendFramework(self);\n            this.installedWebpack = true;\n        }\n        else {\n            await this.installWebpack(self);\n            this.installedFrontend = true;\n        }\n\n        var installInterval = setInterval(() => {\n            if(this.installedDevMode && this.installedWebpack && this.installedFrontend){\n                clearInterval(installInterval);\n                console.log(chalk.green(i18n.__(\"Create package.json ...\")));\n\n                fs.writeFile(path.join(self.settings.path, \"package.json\"), JSON.stringify(this.packageJSONTemplate, null, 4), async (err) => {\n                    console.log(chalk.green(i18n.__(\"Install dependencies ...\")));\n\n                    prompt([{\n                        type: 'confirm',\n                        name: 'install',\n                        message: i18n.__(\"Would you like to install dependencies via NPM?\"),\n                    }]).then(result => {\n                        if(result.install){\n                            var child = spawn(\"npm install -D\", {\n                                shell: true,\n                                env: process.env,\n                                cwd: self.settings.path,\n                                stdio: [process.stdin, process.stdout, process.stderr]\n                            });\n\n                            child.on('exit', function (exitCode) {\n                                const usageText = `Project created successfully!\n\nTo start the project in development mode:\n$ cd ${self.settings.path}\n$ ${PackageJSON[\"@dek/scripts\"].cliDevMode}\n$ npm run dev\n\n`;\n\n                                console.log(usageText);\n                                process.exit(0);\n                            });\n                        }\n                        else{\n                            const usageText = `Project created successfully!\n\nTo start the project in development mode:\n$ cd ${self.settings.path}\n$ ${PackageJSON[\"@dek/scripts\"].cliDevMode}\n$ npm install --save-dev\n$ npm run dev\n\n`;\n\n                            console.log(usageText);\n                            process.exit(0);\n                        }\n                    });\n                });\n            }\n        }, 1000);\n    }\n\n    installFrontendFramework(self){\n        var __self = this;\n        this.installedFrontend = false;\n        console.log(chalk.green(i18n.__(\"Install frontend framework ...\")));\n\n        if(this.directoryExists(path.join(self.settings.path, \"public\"))){\n            rimraf(path.join(self.settings.path, \"public\"), () => {\n                var child = spawn(PackageJSON[\"@dek/frontend\"][self.settings.frontend], {\n                    shell: true,\n                    env: process.env,\n                    cwd: self.settings.path,\n                    stdio: [process.stdin, process.stdout, process.stderr]\n                });\n\n                child.on('exit', function (exitCode) {\n                    __self.installedFrontend = true;\n                });\n            });\n        }\n        else{\n            var child = spawn(PackageJSON[\"@dek/frontend\"][self.settings.frontend], {\n                shell: true,\n                env: process.env,\n                cwd: self.settings.path,\n                stdio: [process.stdin, process.stdout, process.stderr]\n            });\n\n            child.on('exit', function (exitCode) {\n                __self.installedFrontend = true;\n            });\n        }\n    }\n\n    installDevMode(self){\n        this.installedDevMode = false;\n        console.log(chalk.green(i18n.__(\"Install dev mode ...\")));\n\n        try{\n            this.addPackageDependencies(PackageJSON[\"@dek/scripts\"].devMode, { cwd: self.settings.path }, () => {\n                this.installedDevMode = true;\n            });\n        } catch(e){\n            console.log(chalk.red(e.message));\n        }\n    }\n\n    installWebpack(self){\n        this.installedWebpack = false;\n        console.log(chalk.green(i18n.__(\"Install Webpack ...\")));\n\n        this.addPackageDependencies([PackageJSON[\"@dek/scripts\"].webpack, PackageJSON[\"@dek/scripts\"].webpackLoaders], { cwd: self.settings.path }, () => {\n            var WebpackConfigTemplate = require(path.join(CLIPath, \"templates\", \"webpack.config.js\"))(self);\n            fs.writeFileSync(path.join(self.settings.path, \"webpack.config.js\"), WebpackConfigTemplate);\n\n            this.installedWebpack = true;\n            return true;\n        });\n    }\n\n    async addPackageDependencies(scripts, settings, callback){\n        var totalScripts = 0, loadedScripts = 0;\n\n        if(typeof scripts == \"string\")\n            scripts = [scripts];\n\n        scripts.forEach((parScript) => {\n            if(/--save-dev/.test(parScript)){\n                parScript = parScript.replace(\"--save-dev\", \"\");\n\n                parScript.split(\" \").forEach((dependency) => {\n                    if(dependency && dependency != \"\")\n                        this.packageJSONTemplate.devDependencies[dependency] = \"latest\";\n                });\n            }\n            else {\n                parScript = parScript.replace(\"--save\", \"\");\n\n                parScript.split(\" \").forEach((dependency) => {\n                    if(dependency && dependency != \"\")\n                        this.packageJSONTemplate.dependencies[dependency] = \"latest\";\n                });\n            }\n        });\n\n        if(typeof callback == \"function\")\n            setInterval(() => { callback(); }, 1000);\n    }\n\n    directoryExists(filePath){\n        try { return fs.statSync(filePath).isDirectory(); }\n        catch (err) { return false; }\n    }\n\n    Help(){\n        const usageText = `\n  Usage:\n    dek install (with no args, in package dir)\n    dek install <plugin>\n    dek install <git:// url>\n  `\n\n        console.log(usageText)\n    }\n}\n\nexport default async (argv) => {\n    let install = new Install();\n\n    if(argv.h){\n        install.Help();\n    }\n    else if(argv._.length > 1){\n        //Install Plugins\n    }\n    else{\n\n    }\n}\n"]}