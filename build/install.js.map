{"version":3,"sources":["../src/install.js"],"names":["PackageJSON","require","path","join","process","cwd","prompt","inquirer","createPromptModule","registerPrompt","Install","self","packageJSONTemplate","settings","devmode","installDevMode","installedDevMode","frontend","installFrontendFramework","installedWebpack","installWebpack","installedFrontend","installInterval","setInterval","clearInterval","console","log","chalk","green","i18n","__","fs","writeFile","JSON","stringify","err","type","name","message","then","result","install","child","shell","env","stdio","stdin","stdout","stderr","on","exitCode","usageText","cliDevMode","__self","directoryExists","frontendproxy","installProxy","addPackageDependencies","devMode","e","red","webpack","webpackLoaders","WebpackConfigTemplate","writeFileSync","scripts","callback","totalScripts","loadedScripts","forEach","parScript","test","replace","split","dependency","devDependencies","dependencies","filePath","statSync","isDirectory","argv","h","Help","_","length"],"mappings":"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","file":"install.js","sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport npm from \"npm\";\n\nimport 'babel-polyfill';\nimport minimist from \"minimist\";\nimport chalk from \"chalk\";\nimport inquirer from \"inquirer\";\nimport i18n from \"i18n\";\nimport _ from \"lodash\";\nimport gitClone from \"git-clone\";\nimport rimraf from \"rimraf\";\nimport { exec, spawn } from \"child_process\";\n\nimport { installPlugins } from \"./plugins\";\n\nconst PackageJSON = require(path.join(process.cwd(), \"package\"));\n\nlet prompt = inquirer.createPromptModule();\ninquirer.registerPrompt('fuzzypath', require('inquirer-fuzzy-path'));\n\nexport class Install{\n    async bootstrap(self, packageJSONTemplate){\n        this.packageJSONTemplate = packageJSONTemplate;\n\n        if(self.settings.devmode)\n            await this.installDevMode(self);\n        else\n            this.installedDevMode = true;\n\n        if(self.settings.frontend != \"none\"){\n            await this.installFrontendFramework(self);\n            this.installedWebpack = true;\n        }\n        else {\n            await this.installWebpack(self);\n            this.installedFrontend = true;\n        }\n\n        var installInterval = setInterval(() => {\n            if(this.installedDevMode && this.installedWebpack && this.installedFrontend){\n                clearInterval(installInterval);\n                console.log(chalk.green(i18n.__(\"Create package.json ...\")));\n\n                fs.writeFile(path.join(self.settings.path, \"package.json\"), JSON.stringify(this.packageJSONTemplate, null, 4), async (err) => {\n                    console.log(chalk.green(i18n.__(\"Install dependencies ...\")));\n\n                    prompt([{\n                        type: 'confirm',\n                        name: 'install',\n                        message: i18n.__(\"Would you like to install dependencies via NPM?\"),\n                    }]).then(result => {\n                        if(result.install){\n                            var child = spawn(\"npm install -D\", {\n                                shell: true,\n                                env: process.env,\n                                cwd: self.settings.path,\n                                stdio: [process.stdin, process.stdout, process.stderr]\n                            });\n\n                            child.on('exit', function (exitCode) {\n                                const usageText = `Project created successfully!\n\nTo start the project in development mode:\n$ cd ${self.settings.path}\n$ ${PackageJSON[\"@dek/scripts\"].cliDevMode}\n$ npm run dev\n\n`;\n\n                                console.log(usageText);\n                            });\n                        }\n                        else{\n                            const usageText = `Project created successfully!\n\nTo start the project in development mode:\n$ cd ${self.settings.path}\n$ ${PackageJSON[\"@dek/scripts\"].cliDevMode}\n$ npm install --save-dev\n$ npm run dev\n\n`;\n\n                            console.log(usageText);\n                        }\n                    });\n                });\n            }\n        }, 1000);\n    }\n\n    installFrontendFramework(self){\n        var __self = this;\n        this.installedFrontend = false;\n        console.log(chalk.green(i18n.__(\"Install frontend framework ...\")));\n\n        if(this.directoryExists(path.join(self.settings.path, \"public\"))){\n            rimraf(path.join(self.settings.path, \"public\"), () => {\n                var child = spawn(PackageJSON[\"@dek/frontend\"][self.settings.frontend], {\n                    shell: true,\n                    env: process.env,\n                    cwd: self.settings.path,\n                    stdio: [process.stdin, process.stdout, process.stderr]\n                });\n\n                child.on('exit', function (exitCode) {\n                    __self.installedFrontend = true;\n\n                    if(self.settings.frontendproxy)\n                        __self.installProxy(self);\n                });\n            });\n        }\n        else{\n            var child = spawn(PackageJSON[\"@dek/frontend\"][self.settings.frontend], {\n                shell: true,\n                env: process.env,\n                cwd: self.settings.path,\n                stdio: [process.stdin, process.stdout, process.stderr]\n            });\n\n            child.on('exit', function (exitCode) {\n                __self.installedFrontend = true;\n\n                if(self.settings.frontendproxy)\n                    __self.installProxy(self);\n            });\n        }\n    }\n\n    installDevMode(self){\n        this.installedDevMode = false;\n        console.log(chalk.green(i18n.__(\"Install dev mode ...\")));\n\n        try{\n            this.addPackageDependencies(PackageJSON[\"@dek/scripts\"].devMode, { cwd: self.settings.path }, () => {\n                this.installedDevMode = true;\n            });\n        } catch(e){\n            console.log(chalk.red(e.message));\n        }\n    }\n\n    installWebpack(self){\n        this.installedWebpack = false;\n        console.log(chalk.green(i18n.__(\"Install Webpack ...\")));\n\n        this.addPackageDependencies([PackageJSON[\"@dek/scripts\"].webpack, PackageJSON[\"@dek/scripts\"].webpackLoaders], { cwd: self.settings.path }, () => {\n            var WebpackConfigTemplate = require(path.join(process.cwd(), \"templates\", \"webpack.config.js\"))(self);\n            fs.writeFileSync(path.join(self.settings.path, \"webpack.config.js\"), WebpackConfigTemplate);\n\n            this.installedWebpack = true;\n            return true;\n        });\n    }\n\n    async addPackageDependencies(scripts, settings, callback){\n        var totalScripts = 0, loadedScripts = 0;\n\n        if(typeof scripts == \"string\")\n            scripts = [scripts];\n\n        scripts.forEach((parScript) => {\n            if(/--save-dev/.test(parScript)){\n                parScript = parScript.replace(\"--save-dev\", \"\");\n\n                parScript.split(\" \").forEach((dependency) => {\n                    if(dependency && dependency != \"\")\n                        this.packageJSONTemplate.devDependencies[dependency] = \"latest\";\n                });\n            }\n            else {\n                parScript = parScript.replace(\"--save\", \"\");\n\n                parScript.split(\" \").forEach((dependency) => {\n                    if(dependency && dependency != \"\")\n                        this.packageJSONTemplate.dependencies[dependency] = \"latest\";\n                });\n            }\n        });\n\n        if(typeof callback == \"function\")\n            setInterval(() => { callback(); }, 1000);\n    }\n\n    directoryExists(filePath){\n        try { return fs.statSync(filePath).isDirectory(); }\n        catch (err) { return false; }\n    }\n\n    Help(){\n        const usageText = `\n  Usage:\n    dek install (with no args, in package dir)\n    dek install <plugin>\n    dek install <git:// url>\n  `\n\n        console.log(usageText)\n    }\n}\n\nexport default async (argv) => {\n    let install = new Install();\n\n    if(argv.h){\n        install.Help();\n    }\n    else if(argv._.length > 1){\n        //Install Plugins\n    }\n    else{\n\n    }\n}\n"]}